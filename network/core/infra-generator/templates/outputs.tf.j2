# Jinja2 template for Terraform outputs
output "vpc_id" {
  description = "The ID of the VPC"
  value       = aws_vpc.main.id
}

# Outputs for subnets
{% if subnets is defined %}
{% for subnet in subnets %}
output "{{ subnet.name }}_id" {
  description = "Subnet ID for {{ subnet.name }}"
  value       = aws_subnet.{{ subnet.name }}.id
}
{% endfor %}
{% endif %}

# Output for private subnet IDs
{% if subnets is defined %}
output "private_subnet_ids" {
  description = "List of private subnet IDs"
  value = [
    {% for subnet in subnets if not subnet.map_public -%}
      aws_subnet.{{ subnet.name }}.id{% if not loop.last %},{% endif %}
    {%- endfor %}
  ]
}
{% endif %}

# Outputs for route tables
{% if routes is defined %}
{% for route in routes %}
output "{{ route.route_table_name }}_id" {
  value = aws_route_table.{{ route.route_table_name }}.id
}
{% endfor %}
{% endif %}

# Output for Internet Gateway
{% if vpc is defined %}
output "{{ vpc.name }}-igw_id" {
  value = aws_internet_gateway.igw.id
}
{% endif %}

# Output for NAT Gateway (first public subnet)
{% if (nat_gateway is not defined or nat_gateway) and subnets is defined %}
{% set public_subnet = subnets | selectattr('map_public', 'equalto', true) | list | first %}
{% if public_subnet %}
output "{{ public_subnet.name }}-nat_id" {
  value = aws_nat_gateway.nat.id
}
{% endif %}
{% endif %}

# Outputs for NACLs
{% if nacls is defined %}
{% for nacl in nacls %}
output "{{ nacl.name }}_id" {
  value = aws_network_acl.{{ nacl.name }}.id
}
{% endfor %}
{% endif %}

# Outputs for Security Groups
{% if security_groups is defined %}
{% for sg in security_groups %}
output "{{ sg.name }}_id" {
  value = aws_security_group.{{ sg.name | replace('-', '_') }}.id
}
{% endfor %}
{% endif %}

# Outputs for VPC Endpoints
{% if endpoints.s3 %}
output "s3_vpc_endpoint_id" {
  description = "ID of the S3 VPC endpoint"
  value       = aws_vpc_endpoint.s3.id
}
{% endif %}

{% if endpoints.dynamodb %}
output "dynamodb_vpc_endpoint_id" {
  description = "ID of the DynamoDB VPC endpoint"
  value       = aws_vpc_endpoint.dynamodb.id
}
{% endif %}

{% if endpoints.ssm %}
output "ssm_vpc_endpoint_id" {
  description = "ID of the SSM VPC endpoint"
  value       = aws_vpc_endpoint.ssm.id
}
{% endif %}

{% if endpoints.ecr_api %}
output "ecr_api_vpc_endpoint_id" {
  description = "ID of the ECR API VPC endpoint"
  value       = aws_vpc_endpoint.ecr_api.id
}
{% endif %}

{% if endpoints.ecr_dkr %}
output "ecr_dkr_vpc_endpoint_id" {
  description = "ID of the ECR DKR VPC endpoint"
  value       = aws_vpc_endpoint.ecr_dkr.id
}
{% endif %}

{% if endpoints.kms %}
output "kms_vpc_endpoint_id" {
  description = "ID of the KMS VPC endpoint"
  value       = aws_vpc_endpoint.kms.id
}
{% endif %}

{% if endpoints.sqs %}
output "sqs_vpc_endpoint_id" {
  description = "ID of the SQS VPC endpoint"
  value       = aws_vpc_endpoint.sqs.id
}
{% endif %}

{% if endpoints.eventbridge %}
output "eventbridge_vpc_endpoint_id" {
  description = "ID of the EventBridge VPC endpoint"
  value       = aws_vpc_endpoint.eventbridge.id
}
{% endif %}

{% if endpoints.sns %}
output "sns_vpc_endpoint_id" {
  description = "ID of the SNS VPC endpoint"
  value       = aws_vpc_endpoint.sns.id
}
{% endif %}

{% if endpoints.secretsmanager %}
output "secretsmanager_vpc_endpoint_id" {
  description = "ID of the Secrets Manager VPC endpoint"
  value       = aws_vpc_endpoint.secretsmanager.id
}
{% endif %}

{% if endpoints.efs %}
output "efs_vpc_endpoint_id" {
  description = "ID of the EFS VPC endpoint"
  value       = aws_vpc_endpoint.efs.id
}
{% endif %}
